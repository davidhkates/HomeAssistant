# sensor templates for for formatting various time and weather entities

# Sunset as local time in hh:mm am/pm
- name: "Sunset"
  unique_id: sun.sunset
  state: >
    {{ state_attr('sun.sun', 'next_setting')
       | as_datetime
       | as_local
       | as_timestamp
       | timestamp_custom('%I:%M %p')         
    }}
    
# Tesla Model 3 charging status
- name: "Model 3 Charging (Display)"
  unique_id: tesla_model_3_charging_display
  state: >
    {% set s = states('sensor.model_3_charging') %}
    {{ s if s not in ['unknown', 'unavailable', 'None', ''] else 'hide_me' }}

# Tesla Model 3 projected charge completion time in local hh:mm am/pm
- name: "Model 3 Charging Complete"
  unique_id: tesla_model_3_charging_complete
  state: >
    {% set charge_time = states('sensor.model_3_time_to_full_charge') | as_datetime %}
    {% if charge_time %}
      {{ charge_time | as_local | as_timestamp | timestamp_custom('%I:%M %p') }}
    {% else %}
      unknown
    {% endif %}

# Weather forecast overnight low
- name: "OpenWeather Overnight Low"
  unique_id: weather_forecast_overnight_low
  #state: states('weather_forecast_minimum_low')
  #state: "{{ states('weather_forecast_minimum_low') }}"
  state: >
    {{ states('weather_forecast_minimum_low') | float(0) }}
  unit_of_measurement: "Â°F"
